<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>OpenLayers Google Satellite Layer</title>
    <link rel="stylesheet" href="qgis.css" type="text/css">
    <script src="http://www.openlayers.org/api/2.7/OpenLayers.js" type="text/javascript"></script>
    <script src="OlOverviewMarker.js"></script>
    <script type="text/javascript">
        var map;
        var oloMarker; // OpenLayer Overview Marker
        var mapBounds = new OpenLayers.Bounds( 15.9362103992, -34.9158403601, 33.5125595672, -21.9620062721);
	    var mapMinZoom = 3;
	    var mapMaxZoom = 8;
        function init() {
            map = new OpenLayers.Map('map', {
                theme: null,
                controls: [],
                units: "degrees",
                maxResolution: 0.703125,
                maxExtent: mapBounds
            });

            var tmsoverlay = new OpenLayers.Layer.TMS( "TMS Overlay", "",
                {
                    serviceVersion: '.', layername: '.', alpha: true,
					type: 'png', getURL: overlay_getTileURL,
                });
            map.addLayer(tmsoverlay);

            // disable 45Â° imagery
            //tmsoverlay.mapObject.setTilt(0);


	        map.zoomToExtent( mapBounds );
            oloMarker = new OlOverviewMarker(map, getPathUpper(document.URL) + '/x.png');
        }
        
        function overlay_getTileURL(bounds) {
			bounds = this.adjustBounds(bounds);
            var res = this.map.getResolution();
            var x = Math.round((bounds.left - this.tileOrigin.lon) / (res * this.tileSize.w));
            var y = Math.round((bounds.bottom - this.tileOrigin.lat) / (res * this.tileSize.h));
            var z = this.map.getZoom();
			var path = this.serviceVersion + "/" + this.layername + "/" + z + "/" + x + "/" + y + "." + this.type;
			var url = this.url;
	        if (mapBounds.intersectsBounds( bounds ) && z >= mapMinZoom && z <= mapMaxZoom) {
               // console.log( this.url + z + "/" + x + "/" + y + "." + this.type);
               return this.url + z + "/" + x + "/" + y + "." + this.type;
            } else {
               return "http://www.maptiler.org/img/none.png";
            }
        }
        
    </script>
  </head>
  <body onload="init()">
    <div id="map"></div>
  </body>
</html>
